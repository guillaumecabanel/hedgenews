<% if @selected_stories.empty? %>

  <div class='container'>
    <div class="flex-box-space-around catchline wrapper-white font-header-app">
      <div>
        <h2 class= "font-header-app">Aucun article trouvé pour <em><%= @topic_search %></em>.</h2>
        <h2 class= "font-header-app">Modifiez votre recherche :</h2>
      </div>
      <%= render 'shared/search_bar', value: @topic_search %>
    </div>
    <%= link_to root_path do %>
      <%= image_tag "icone/hedgenews_logo.FF682F.png", class: "animate-logo" %>
    <%end%>
  </div>

<% else %>
  <div class="container">
    <div class="flex-box-space-around font-header-app">
      <div id="search-wrapper" class="wrapper-white">
        <div>
          <h2 class="font-header-app"><%= pluralize(@selected_stories.count, 'article selectionné', plural: 'articles sélectionnés')%>  parmi <%= @stories.count %> pour <em><%= @topic_search %></em></h2>
        </div>
        <%= render 'shared/search_bar', value: @topic_search %>
      </div>
    </div>
    <div class="flex-box-center">
      <a href="#" class="btn btn-bordered btn-bordered-primary btn-bordered-primary-on-grey-background open-all">Lire tous les articles complets</a>
      <%= content_tag :div, class: "selected_urls", data: {url: @selected_urls} do %>
      <% end %>
      <%if current_user %>
        <%= form_tag topics_path, method: :post, id: 'topic' do %>
          <%= hidden_field_tag "topic[name]", @topic_search %>
          <%= submit_tag 'Ajouter le sujet à mes revues de presse', class: 'btn btn-bordered btn-bordered-info btn-bordered-info-on-grey-background' %>
        <% end %>
      <% end %>
    </div>
    <br>
  </div>

  <div class='container'>
    <div class='row-fix'>
      <% @selected_stories.each do |story| %>
        <div class='card'>
          <h3><%= link_to story.links.permalink, target: '_blank' do %></h3>
            <div class='image-article-card'>
              <% unless story.media.empty?%>
                <%= image_tag story.media[0].url %>
              <% end %>
            </div>
          <% end %>

          <div class="panel article-panel card-body">
            <div class="panel-heading">

          <div class="flex-box-space-between">
            <div>
              <%= image_tag "logo/logos_custom/#{story.source.name}-logo-black.png", width: "80px" %>
            </div>
            <div>
              <%= link_to 'Ajouter à une revue de presse', class: "" %>
            </div>
            <div>
              <% if current_user %>
                <div class="bookmark_form_container" data-story-id="<%= story.id %>">
                  <% if current_user.articles.include?(Article.find_by_aylien_id(story.id)) %>
                    <%= render 'unbookmark_form', story: story %>
                  <% else %>
                    <%= render 'bookmark_form', story: story, hash_source_url: @hash_source_url %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>

              <h3><%= link_to story.title, story.links.permalink, target: '_blank' %></h3>
              <h6>Publié il y a <%= distance_of_time_in_words(story.published_at, Time.now) %> <% if story.author.name != "" %>par <%= story.author.name %><% end %></h6>
              <ul class= "list-inline">
                <li>
                  <% story.hashtags.each_with_index do |hashtag, index| %>
                    <% next if index > 4%>
                    <span class="hashtag"><%= hashtag %></span>
                  <% end %>
                </li>
              </ul>
              <ul class= "list-inline">
                <li><i class="fa fa-clock-o" aria-hidden="true"></i></li>
                <li><h6><%= time_to_read(story.words_count) %></h6></li>
              </ul>

  <!--             <h6><%= story.words_count %> mots | <%= story.sentiment %></h6> -->
            </div>
            <div class="panel-body">
              <% if story.summary.sentences.join("\n") == ""%>
                <p>Nous n'avons pas pu accéder à un extrait de cet article.</p>
              <% else %>
                <p><%=story.summary.sentences.join("\n") %></p>
              <% end %>
              <!-- <p><%= story.body %></p> -->
            </div>
            <div class="panel-body">
              <h6><strong>Contexte :</strong></h6>
              <% if ["Le Monde", "Le Figaro", "Le Point"].include?(Source.where(aylien_id: story.source.id.to_i).first.name) %>
                <h6>A propos du <%= Source.where(aylien_id: story.source.id.to_i).first.name.split(" ").last %></strong></h6>
              <% elsif ["Les Échos"].include?(Source.where(aylien_id: story.source.id.to_i).first.name) %>
                <h6>A propos des <%= Source.where(aylien_id: story.source.id.to_i).first.name.split(" ").last %></strong></h6>
              <% else %>
                <h6>A propos de <%= Source.where(aylien_id: story.source.id.to_i).first.name %></strong></h6>
              <% end %>
              <%= raw(Source.where(aylien_id: story.source.id.to_i).first.presentation) %>
            </div>
            <div class="flex-box-center">
              <%= link_to "Lire l'article complet", story.links.permalink, class: "btn btn-bordered btn-bordered-info", target: '_blank' %>
              <%= link_to "Découvrir une opinion différente", story_opposite_url(story, @hash_source_url), class: "btn btn-bordered btn-bordered-primary" , target: '_blank'%>
            </div>

          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="container text-center">
    <%= link_to root_path do %>
      <%= image_tag "icone/rewind.FF682F.png", class: 'image-small' %>
    <%end%>
  </div>

<% end %>

<% content_for(:after_js) do %>
  <script>
    $(document).ready(function(){

      window.scroll(0, 60);

      $('#topic_search').click(function(){
        $(this).val("");
      });

      $('a.open-all').click(function(e) {
        e.preventDefault();
        $('.selected_urls').data('url').forEach(function(url_source) {
          setTimeout(function() {}, 1000);
          window.open(url_source);
          self.focus();
          // if(!win){
          //   //Broswer has blocked it
          //   alert('Please allow popups for this site');
          // }
        });
      });

    });
  </script>
<% end %>
